<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Yugo OPS - Minecraft Player List & Profile</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #1a1a1a;
    color: white;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  #player-list {
    width: 320px;
    background: #222;
    overflow-y: auto;
    padding: 10px;
    border-right: 2px solid #444;
  }
  #player-list div.player {
    padding: 8px 12px;
    margin-bottom: 8px;
    background: #333;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
  }
  #player-list div.player:hover {
    background: #555;
  }
  #profile-view {
    flex: 1;
    padding: 20px;
    background: #111;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }
  #profile-header {
    font-size: 24px;
    margin-bottom: 10px;
  }
  #model-container {
    width: 300px;
    height: 300px;
    margin-bottom: 20px;
  }
  #tiers-list {
    flex: 1;
    overflow-y: auto;
    max-width: 600px;
  }
  .tier-item {
    background: #222;
    margin-bottom: 8px;
    padding: 8px 12px;
    border-radius: 5px;
    display: flex;
    align-items: center;
  }
  .tier-text {
    flex: 1;
    font-size: 18px;
  }
  select.tier-select, select.kit-select {
    margin-left: 10px;
    font-size: 16px;
    padding: 2px 5px;
    border-radius: 4px;
    border: none;
    background: #444;
    color: white;
    cursor: pointer;
  }
  button.remove-tier {
    margin-left: 10px;
    background: #a33;
    border: none;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
  }
  button.remove-tier:hover {
    background: #d55;
  }
  #add-tier-btn {
    margin-top: 10px;
    padding: 8px 12px;
    font-size: 16px;
    cursor: pointer;
    background: #28a745;
    border: none;
    border-radius: 5px;
    color: white;
    width: 200px;
  }
  #add-tier-btn:hover {
    background: #3ecf6f;
  }
  #save-btn {
    margin-top: 20px;
    padding: 10px 16px;
    font-size: 18px;
    cursor: pointer;
    background: #007bff;
    border: none;
    border-radius: 5px;
    color: white;
    width: 200px;
  }
  #save-btn:hover {
    background: #3399ff;
  }
  #no-selection {
    margin-top: 50px;
    font-size: 18px;
    color: #888;
  }
</style>

<!-- Minecraft Player Model Viewer CDN -->
<script src="https://cdn.jsdelivr.net/npm/minecraft-player-model-viewer@1.3.4/dist/minecraft-player-model-viewer.min.js"></script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

  <div id="player-list"></div>

  <div id="profile-view">
    <div id="no-selection">Select a player from the list to see their profile.</div>
  </div>

<script>
  // Firebase config from your project
  const firebaseConfig = {
    apiKey: "AIzaSyDziQ1jdojoUwYDUpGLNfbzMDh5-iB1QIQ",
    authDomain: "yugotiers-b297d.firebaseapp.com",
    projectId: "yugotiers-b297d",
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const playerList = document.getElementById('player-list');
  const profileView = document.getElementById('profile-view');
  const noSelection = document.getElementById('no-selection');

  let playersData = [];
  let selectedPlayer = null;

  // Available tiers for dropdown
  const tiers = ["HT1", "HT2", "HT3", "HT4", "HT5", "LT1", "LT2", "LT3", "LT4", "LT5"];
  // Kits available (example)
  const kits = ["CRYSTALS", "SWORD", "BOW", "FISTS", "NONE"];

  // Fetch all players from Firestore
  async function fetchPlayers() {
    try {
      const snapshot = await db.collection('players').get();
      playersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderPlayerList();
    } catch (error) {
      console.error("Error fetching players:", error);
      playerList.innerHTML = '<div style="color: red;">Error loading players.</div>';
    }
  }

  // Render the list of players on left panel
  function renderPlayerList() {
    playerList.innerHTML = '';
    playersData.forEach(player => {
      const div = document.createElement('div');
      div.className = 'player';
      div.textContent = player.name;
      div.onclick = () => openProfile(player);
      playerList.appendChild(div);
    });
  }

  // Open profile on right panel
  function openProfile(player) {
    selectedPlayer = player;
    noSelection.style.display = 'none';
    profileView.innerHTML = ''; // Clear

    // Header with player name
    const header = document.createElement('div');
    header.id = 'profile-header';
    header.textContent = player.name;
    profileView.appendChild(header);

    // 3D model container
    const modelContainer = document.createElement('div');
    modelContainer.id = 'model-container';
    profileView.appendChild(modelContainer);

    // Create the 3D player model viewer
    const modelViewer = document.createElement('minecraft-player-model-viewer');
    modelViewer.skin = `https://mineskin.org/skin/preview/${player.name}.png`; // default: minecraft username skin
    modelViewer.width = 300;
    modelViewer.height = 300;
    modelViewer.style.borderRadius = '10px';
    modelContainer.appendChild(modelViewer);

    // Tiers container
    const tiersList = document.createElement('div');
    tiersList.id = 'tiers-list';
    profileView.appendChild(tiersList);

    // Render player's tiers editable list
    renderTiers(tiersList, player);

    // Add Tier button
    const addTierBtn = document.createElement('button');
    addTierBtn.id = 'add-tier-btn';
    addTierBtn.textContent = 'Add Tier';
    addTierBtn.onclick = () => {
      if (!player.tiers) player.tiers = [];
      player.tiers.push({ tier: tiers[0], kit: kits[0] });
      renderTiers(tiersList, player);
    };
    profileView.appendChild(addTierBtn);

    // Save changes button
    const saveBtn = document.createElement('button');
    saveBtn.id = 'save-btn';
    saveBtn.textContent = 'Save Changes';
    saveBtn.onclick = () => savePlayerData(player);
    profileView.appendChild(saveBtn);
  }

  // Render tiers editable list with dropdowns and remove buttons
  function renderTiers(container, player) {
    container.innerHTML = '';
    if (!player.tiers || player.tiers.length === 0) {
      container.textContent = "No tiers assigned.";
      return;
    }

    player.tiers.forEach((tierObj, idx) => {
      const div = document.createElement('div');
      div.className = 'tier-item';

      // Tier select dropdown
      const tierSelect = document.createElement('select');
      tierSelect.className = 'tier-select';
      tiers.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        if (tierObj.tier === t) opt.selected = true;
        tierSelect.appendChild(opt);
      });
      tierSelect.onchange = e => {
        player.tiers[idx].tier = e.target.value;
      };
      div.appendChild(tierSelect);

      // Kit select dropdown
      const kitSelect = document.createElement('select');
      kitSelect.className = 'kit-select';
      kits.forEach(k => {
        const opt = document.createElement('option');
        opt.value = k;
        opt.textContent = k;
        if (tierObj.kit === k) opt.selected = true;
        kitSelect.appendChild(opt);
      });
      kitSelect.onchange = e => {
        player.tiers[idx].kit = e.target.value;
      };
      div.appendChild(kitSelect);

      // Remove tier button
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-tier';
      removeBtn.textContent = 'Remove';
      removeBtn.onclick = () => {
        player.tiers.splice(idx, 1);
        renderTiers(container, player);
      };
      div.appendChild(removeBtn);

      container.appendChild(div);
    });
  }

  // Save player data to Firestore
  async function savePlayerData(player) {
    try {
      await db.collection('players').doc(player.id).update({
        tiers: player.tiers || [],
      });
      alert("Player data saved!");
      // Reload player list to reflect changes
      fetchPlayers();
    } catch (e) {
      alert("Error saving player data: " + e.message);
    }
  }

  // Initial load
  fetchPlayers();
</script>

</body>
</html>