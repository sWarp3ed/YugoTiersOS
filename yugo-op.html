<!-- Save this as index.html or your main page -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yugo OPS</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      background-image: url("https://picfiles.alphacoders.com/478/478314.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      margin: auto;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      color: #ccc;
    }

    #addplayer-button {
      position: absolute;
      top: 20px;
      left: 400px;
      background-color: greenyellow;
      border-radius: 10px;
      height: 60px;
      width: 65px;
      cursor: pointer;
    }

    #player-list {
      margin-top: 70px;
      margin-left: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-width: 400px;
    }

    .player-link {
      text-decoration: none;
      color: #fff;
      background-color: #1f1f1f;
      padding: 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
      font-size: 20px;
      cursor: pointer;
    }

    .player-link:hover {
      background-color: #2c2c2c;
    }

    #search-bar {
      position: absolute;
      top: 20px;
      left: 35px;
      padding: 10px;
      border-radius: 5px;
      font-size: 17px;
      width: 400px;
      height: 25px;
      transition: width 0.3s ease;
      background: rgba(0, 0, 0, 0.4);
  border: none;
  border-radius: 8px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
  color: white;
    }

    #search-bar::placeholder {
  color: rgba(255, 255, 255, 0.6);
}

/* Optional: same scrollbar style inside search input if needed */
#search-bar::-webkit-scrollbar {
  width: 6px;
}
#search-bar::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.4);
  border-radius: 3px;
}

    #modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #modal {
      background-color: #1f1f1f;
      padding: 20px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 300px;
    }

    #modal input, .tier-entry input {
      padding: 10px;
      border: none;
      border-radius: 4px;
    }

    #done-button, #cancel-button, .tier-entry button {
      padding: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #done-button { background-color: #03dac5; color: black; }
    #cancel-button, .tier-entry button { background-color: #cf6679; color: black; }

    #player-profile {
      position: fixed;
      top: 70px;
      right: 200px;
      width: 1000px;
      height: 700px;
      background-color: #1f1f1f;
      border-radius: 8px;
      padding: 20px;
      display: none;
      flex-direction: column;
      gap: 12px;
      font-size: 50px;
      color: white;
      opacity: 0.9;
      text-align: left;
    }

    .tier-entry {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tier-entry select {
      padding: 6px;
    }

    #profile-skin {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 160px;
      height: 160px;
      border-radius: 10px;
      border: 4px solid #464646;
    }

    .kit-icon {
      width: 40px;
      height: 40px;
      margin-left: 50px;
      cursor: pointer;
    }

    #kit-panel {
      display: none;
      position: fixed;
      bottom: 175px;
      right: 250px;
      background-color: #2e2e2e;
      border-radius: 12px;
      padding: 20px;
      width: 900px;
      height: 260px;
      color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      z-index: 999;
      opacity: 0.9;
    }


   #tier-buttons button {
  padding: 6px 12px;
  border: 1px solid #ccc;
  background-color: #f0f0f0;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s ease;
  font-weight: bold;
}

#tier-buttons button:hover {
  background-color: #e0e0e0;
}

#tier-buttons button.selected {
  background-color: #00cc99;
  color: white;
  border-color: #00b386;
}
.apply-btn {
  margin-top: 10px;
  padding: 6px 12px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.apply-btn:hover {
  background-color: #45a049;
}

.tier-popup {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

.tier-label {
  margin-top: 4px;
  color: white;
}

#modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
}

#modal {
  background: white;
  padding: 20px;
  border-radius: 8px;
}

#open-add-player {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #4CAF50; /* Green */
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    transition: background-color 0.3s ease;
  }

  #open-add-player:hover {
    background-color: #45a049;
  }

  html, body {
  height: 100%;
  overflow: hidden;
  }

/* Player list container */
#player-list {
  position: relative;
  margin-left: 20px; /* move right from tier boxes */
  height: 800px; /* make taller so you can scroll fully */
  padding: 8px 8px 30px 8px;
  overflow-y: auto;
  overflow-x: hidden;

  background: rgba(0, 0, 0, 0.4);
  border-radius: 8px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.3);

  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.4) transparent;
}

/* Scrollbar styling for Chrome, Edge, Safari */
#player-list::-webkit-scrollbar {
  width: 8px;
}

#player-list::-webkit-scrollbar-track {
  background: transparent;
}

#player-list::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.4);
  border-radius: 4px;
}

#player-list::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.6);
}

/* Player item */
.player-item {
  padding: 6px 8px;
  margin-bottom: 4px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 4px;
  color: white;
  font-size: 14px;
  cursor: pointer;
  transition: background 0.2s;
}

.player-item:hover {
  background: rgba(255, 255, 255, 0.15);
}

  </style>
</head>
<body>
  <input id="search-bar" placeholder="Search players..." />
  <div id="player-list"></div>
  <button id="open-add-player">＋</button>

  <!-- Add Player Modal -->
  <div id="modal-overlay">
    <div id="modal">
      <input id="player-name-input" placeholder="Enter player name" />
      <button id="done-button">Add</button>
      <button id="cancel-button">Cancel</button>
    </div>
  </div>

  <!-- Player Profile Panel -->
  <div id="player-profile">
    <button id="close-profile" style="position: absolute; top: 8px; left: 8px; background: transparent; border: none; font-size: 40px; cursor: pointer; color: white;">×</button>
  <img id="profile-skin" alt="Player Skin" />
  <h2 id="profile-name">Player Name</h2>
  <div id="tier-popup-container" style="position: relative; width: 100%; height: 0;"></div>
  <div id="profile-tiers"></div>
  <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 10px; font-size:20px;">
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/vanilla.svg" class="kit-icon" onclick="openKitSettings('Crystal')" />
      <div id="tier-Crystal"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/axe.svg" class="kit-icon" onclick="openKitSettings('Axe')" />
      <div id="tier-Axe"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/sword.svg" class="kit-icon" onclick="openKitSettings('Sword')" />
      <div id="tier-Sword"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/uhc.svg" class="kit-icon" onclick="openKitSettings('Uhc')" />
      <div id="tier-Uhc"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/smp.svg" class="kit-icon" onclick="openKitSettings('Smp')" />
      <div id="tier-Smp"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/nethop.svg" class="kit-icon" onclick="openKitSettings('Nethop')" />
      <div id="tier-Nethop"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/pot.svg" class="kit-icon" onclick="openKitSettings('DiamondPot')" />
      <div id="tier-DiamondPot"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://subtiers.net/assets/dia_smp-523efa38.svg" class="kit-icon" onclick="openKitSettings('DiamondSmp')" />
      <div id="tier-DiamondSmp"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/mace.svg" class="kit-icon" onclick="openKitSettings('Mace')" />
      <div id="tier-Mace"></div>
    </div>
  </div>
</div>

  <div id="kit-panel" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #222;
  padding: 20px;
  border-radius: 10px;
  z-index: 999;
  color: white;
  text-align: center;
">
  <h3 id="kit-title">Select Tier</h3>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 10px 0;">
    <button onclick="selectTier('LT5')">LT5</button>
<button onclick="selectTier('HT5')">HT5</button>
<button onclick="selectTier('LT4')">LT4</button>
<button onclick="selectTier('HT4')">HT4</button>
<button onclick="selectTier('LT3')">LT3</button>
<button onclick="selectTier('HT3')">HT3</button>
<button onclick="selectTier('LT2')">LT2</button>
<button onclick="selectTier('HT2')">HT2</button>
<button onclick="selectTier('LT1')">LT1</button>
<button onclick="selectTier('HT1')">HT1</button>
  </div>
  <button onclick="closeKitSettings()">Cancel</button>
</div>

 <script>
  const firebaseConfig = {
    apiKey: "AIzaSyDziQ1jdojoUwYDUpGLNfbzMDh5-iB1QIQ",
    authDomain: "yugotiers-b297d.firebaseapp.com",
    projectId: "yugotiers-b297d",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let selectedPlayerId = null;
  const profile = document.getElementById('player-profile');
  const profileName = document.getElementById('profile-name');
  const profileTiers = document.getElementById('profile-tiers');

  // Make sure your HTML contains this container inside #player-profile:
  // <div id="tier-popup-container" style="position: relative; width: 100%; height: 0;"></div>
  const tierPopupContainer = document.getElementById('tier-popup-container');

  // New close button element inside the profile (make sure this exists in your HTML)
  const closeProfileBtn = document.getElementById('close-profile');
  closeProfileBtn.addEventListener('click', () => {
    profile.style.display = 'none';
    selectedPlayerId = null;
    // Remove popup if open
    const oldPopup = document.getElementById('big-tier-popup');
    if (oldPopup) oldPopup.remove();
  });

  async function fetchPlayers() {
    const snapshot = await db.collection('players').get();
    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  }

  function openProfile(player) {
    selectedPlayerId = player.id;
    profile.style.display = 'flex';
    profileName.textContent = player.name;

    // Set player skin image using Minotar API (80x80 px)
    document.getElementById('profile-skin').src = `https://minotar.net/avatar/${player.name}/180`;

    // Clear previous tier labels and remove any existing popup
    const kitIcons = profile.querySelectorAll('.kit-icon');
    kitIcons.forEach(icon => {
      const next = icon.nextSibling;
      if (next && next.className === 'tier-label') {
        next.remove();
      }
      // Reset click handlers to new popup function
      icon.onclick = null;
    });
    const oldPopup = document.getElementById('big-tier-popup');
    if (oldPopup) oldPopup.remove();

    // Add tier labels next to each kit icon, set up click handlers
    kitIcons.forEach(icon => {
      const kitName = icon.getAttribute('onclick').match(/openKitSettings\('(.+)'\)/)[1];
      let existingTier = player.tiers?.find(t => t.kit === kitName.toUpperCase());
      let label = document.createElement('div');
      label.className = 'tier-label';
      label.textContent = existingTier ? existingTier.tier : 'No Tier';
      icon.insertAdjacentElement('afterend', label);
      icon.onclick = () => showTierOptions(icon, kitName.toUpperCase(), label);
    });
  }

  function showTierOptions(icon, kit, label, peakLabel) {
  // Remove previous popup if any
  const old = document.querySelector('.tier-popup');
  if (old) old.remove();

  const popup = document.createElement('div');
  popup.className = 'tier-popup';
  popup.id = 'big-tier-popup';

  // Style popup (same as before)...
  popup.style.position = 'absolute';
  popup.style.backgroundColor = '#222';
  popup.style.border = '2px solid #888';
  popup.style.borderRadius = '8px';
  popup.style.padding = '20px';
  popup.style.zIndex = '2000';
  popup.style.width = '95%';
  popup.style.maxWidth = '900px';
  popup.style.height = '250px';

  // Position popup (same as before)...
  const profileRect = profile.getBoundingClientRect();
  const scrollY = window.scrollY || window.pageYOffset;
  let leftPos = profileRect.left + profileRect.width / 40;
  popup.style.left = `${leftPos}px`;
  popup.style.transform = 'translateX(-50%)';
  let topPos = profileRect.bottom + scrollY - 600 ;
  popup.style.top = `${topPos}px`;

  // Toggle button to switch between editing current and peak tier
  const toggleBtn = document.createElement('button');
  toggleBtn.textContent = 'Edit Peak Tier';  // initial mode is editing current tier
  toggleBtn.style.marginBottom = '15px';
  toggleBtn.style.padding = '8px 12px';
  toggleBtn.style.cursor = 'pointer';
  toggleBtn.style.borderRadius = '6px';
  toggleBtn.style.border = 'none';
  toggleBtn.style.backgroundColor = '#444';
  toggleBtn.style.color = 'white';
  toggleBtn.style.fontSize = '16px';

  popup.appendChild(toggleBtn);

  // Container for tier buttons
  const tierContainer = document.createElement('div');
  tierContainer.style.display = 'flex';
  tierContainer.style.flexWrap = 'wrap';
  tierContainer.style.justifyContent = 'center';
  tierContainer.style.alignItems = 'center';
  tierContainer.style.gap = '10px';
  tierContainer.style.overflowY = 'auto';
  tierContainer.style.height = '180px';

  popup.appendChild(tierContainer);

  const tiers = ["LT5","HT5","LT4","HT4","LT3","HT3","LT2","HT2","LT1","HT1","RLT2","RHT2","RLT1","RHT1"];

  let editingPeak = false;  // start editing current tier

  function renderTierButtons(editPeak) {
    tierContainer.innerHTML = '';
    tiers.forEach(tier => {
      const btn = document.createElement('button');
      btn.textContent = tier;
      btn.style.flex = '0 0 80px';
      btn.style.height = '50px';
      btn.style.fontSize = '18px';
      btn.style.cursor = 'pointer';
      btn.style.border = 'none';
      btn.style.borderRadius = '6px';
      btn.style.backgroundColor = '#555';
      btn.style.color = 'white';
      btn.style.transition = 'background-color 0.3s';
      btn.onmouseover = () => btn.style.backgroundColor = '#777';
      btn.onmouseout = () => btn.style.backgroundColor = '#555';

      btn.onclick = async () => {
        if (editPeak) {
          await applyPeakTierToPlayer(kit, tier);
          peakLabel.textContent = `Peak: ${tier}`;
        } else {
          await applyTierToPlayer(kit, tier);
          label.textContent = tier;

          // Optionally update peak tier logic if needed here
        }
        popup.remove();
      };

      tierContainer.appendChild(btn);
    });
  }

  toggleBtn.onclick = () => {
    editingPeak = !editingPeak;
    toggleBtn.textContent = editingPeak ? 'Edit Current Tier' : 'Edit Peak Tier';
    renderTierButtons(editingPeak);
  };

  renderTierButtons(editingPeak);

  tierPopupContainer.appendChild(popup);

  // Close popup when clicking outside
  function onClickOutside(e) {
    if (!popup.contains(e.target) && e.target !== icon) {
      popup.remove();
      document.removeEventListener('click', onClickOutside);
    }
  }
  setTimeout(() => document.addEventListener('click', onClickOutside), 100);
}

    

  const modalOverlay = document.getElementById('modal-overlay');
  const playerNameInput = document.getElementById('player-name-input');
  const doneButton = document.getElementById('done-button');
  const cancelButton = document.getElementById('cancel-button');
  const openAddPlayerBtn = document.getElementById('open-add-player');

  let players = []; // global players array
  let currentEditingTiers = []; // for new player

  openAddPlayerBtn.addEventListener('click', () => {
    playerNameInput.value = "";
    modalOverlay.style.display = "flex";
    playerNameInput.focus();
  });

  cancelButton.addEventListener('click', () => {
    modalOverlay.style.display = "none";
  });

  doneButton.addEventListener('click', async () => {
    const name = playerNameInput.value.trim();
    if (!name) {
      alert("Please enter a player name");
      return;
    }

    if (players.find(p => p.name.toLowerCase() === name.toLowerCase())) {
      alert("Player with this name already exists.");
      return;
    }

    const newPlayer = {
      name,
      tiers: currentEditingTiers.slice()
    };

    try {
      const docRef = await db.collection('players').add(newPlayer);
      newPlayer.id = docRef.id;
      players.push(newPlayer);
      modalOverlay.style.display = "none";
      currentEditingTiers = [];
      renderPlayers(players);
      alert(`Player "${name}" added!`);
    } catch (e) {
      alert("Error adding player: " + e.message);
    }
  });

  async function applyTierToPlayer(kit, tier) {
    if (!selectedPlayerId) return;

    const docRef = db.collection('players').doc(selectedPlayerId);
    const doc = await docRef.get();
    const player = doc.data();

    let tiers = player.tiers || [];

    const existingIndex = tiers.findIndex(t => t.kit === kit);
    if (existingIndex !== -1) {
      tiers[existingIndex].tier = tier;
    } else {
      tiers.push({ kit, tier });
    }

    await docRef.update({ tiers });

    let localPlayer = players.find(p => p.id === selectedPlayerId);
    if (localPlayer) {
      localPlayer.tiers = tiers;
    }
  }

  async function getUUID(username) {
    try {
      const response = await fetch(`https://api.mojang.com/users/profiles/minecraft/${username}`);
      if (!response.ok) throw new Error('User not found');
      const data = await response.json();
      return data.id;
    } catch (error) {
      console.error('Error fetching UUID:', error);
      return null;
    }
  }

  async function setPlayerSkin(username, imgElement) {
    const uuid = await getUUID(username);
    if (uuid) {
      imgElement.src = `https://crafatar.com/avatars/${uuid}?size=160&overlay`;
    } else {
      imgElement.src = 'https://crafatar.com/avatars/8667ba71b85a4004af54457a9734eed7?size=160&overlay';
    }
  }

  const playerList = document.getElementById('player-list');
  const searchBar = document.getElementById('search-bar');

  async function refreshPlayers(filter = '') {
    players = await fetchPlayers();
    if (filter) {
      players = players.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
    }
    renderPlayers(players);
  }

  function renderPlayers(players) {
    playerList.innerHTML = '';
    players.forEach(p => {
      const container = document.createElement('div');
      container.className = 'player-link';
      container.style.display = 'flex';
      container.style.justifyContent = 'space-between';
      container.style.alignItems = 'center';
      container.style.marginBottom = '5px';
      container.style.cursor = 'pointer';

      container.onclick = () => openProfile(p);

      const nameSpan = document.createElement('span');
      nameSpan.textContent = p.name;

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = '✖';
      deleteBtn.style.marginLeft = '10px';
      deleteBtn.style.padding = '2px 6px';
      deleteBtn.style.background = '#f44336';
      deleteBtn.style.color = 'white';
      deleteBtn.style.border = 'none';
      deleteBtn.style.borderRadius = '4px';
      deleteBtn.style.cursor = 'pointer';
      deleteBtn.onclick = async (e) => {
        e.stopPropagation();
        const confirmDelete = confirm(`Are you sure you want to delete "${p.name}"?`);
        if (confirmDelete) {
          await db.collection('players').doc(p.id).delete();
          refreshPlayers();
        }
      };

      container.appendChild(nameSpan);
      container.appendChild(deleteBtn);
      playerList.appendChild(container);
    });
  }

  // Close big tier popup if clicking outside it or kit icons
  document.addEventListener('click', (event) => {
    const popup = document.getElementById('big-tier-popup');
    if (!popup) return;

    const isInsidePopup = popup.contains(event.target);
    const isKitIcon = event.target.classList.contains('kit-icon');

    if (!isInsidePopup && !isKitIcon) {
      popup.remove();
    }
  });

  searchBar.oninput = () => refreshPlayers(searchBar.value);
  refreshPlayers();
</script>

</body>
</html>

