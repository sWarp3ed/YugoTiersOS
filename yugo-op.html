<!-- Save this as index.html or your main page -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yugo OPS</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      background-image: url("https://picfiles.alphacoders.com/478/478314.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      margin: auto;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      color: #ccc;
    }

    #addplayer-button {
      position: absolute;
      top: 20px;
      left: 400px;
      background-color: greenyellow;
      border-radius: 10px;
      height: 60px;
      width: 65px;
      cursor: pointer;
    }

    #player-list {
      margin-top: 70px;
      margin-left: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-width: 400px;
    }

    .player-link {
      text-decoration: none;
      color: #fff;
      background-color: #1f1f1f;
      padding: 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
      font-size: 20px;
      cursor: pointer;
    }

    .player-link:hover {
      background-color: #2c2c2c;
    }

    #search-bar {
      position: absolute;
      top: 20px;
      left: 35px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      background-color: #1e1e1e;
      color: white;
      font-size: 17px;
      width: 300px;
      height: 40px;
      transition: width 0.3s ease;
    }

    #search-bar:hover {
      width: 330px;
    }

    #modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #modal {
      background-color: #1f1f1f;
      padding: 20px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 300px;
    }

    #modal input, .tier-entry input {
      padding: 10px;
      border: none;
      border-radius: 4px;
    }

    #done-button, #cancel-button, .tier-entry button {
      padding: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #done-button { background-color: #03dac5; color: black; }
    #cancel-button, .tier-entry button { background-color: #cf6679; color: black; }

    #player-profile {
      position: fixed;
      top: 70px;
      right: 200px;
      width: 1000px;
      height: 700px;
      background-color: #1f1f1f;
      border-radius: 8px;
      padding: 20px;
      display: none;
      flex-direction: column;
      gap: 12px;
      font-size: 50px;
      color: white;
      opacity: 0.9;
      text-align: left;
    }

    .tier-entry {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tier-entry select {
      padding: 6px;
    }

    #profile-skin {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 160px;
      height: 160px;
      border-radius: 10px;
      border: 4px solid #464646;
    }

    .kit-icon {
      width: 40px;
      height: 40px;
      margin-left: 50px;
      cursor: pointer;
    }

    #kit-panel {
      display: none;
      position: fixed;
      bottom: 175px;
      right: 250px;
      background-color: #2e2e2e;
      border-radius: 12px;
      padding: 20px;
      width: 900px;
      height: 260px;
      color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      z-index: 999;
      opacity: 0.9;
    }


   #tier-buttons button {
  padding: 6px 12px;
  border: 1px solid #ccc;
  background-color: #f0f0f0;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s ease;
  font-weight: bold;
}

#tier-buttons button:hover {
  background-color: #e0e0e0;
}

#tier-buttons button.selected {
  background-color: #00cc99;
  color: white;
  border-color: #00b386;
}
.apply-btn {
  margin-top: 10px;
  padding: 6px 12px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.apply-btn:hover {
  background-color: #45a049;
}

.tier-popup {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

.tier-label {
  margin-top: 4px;
  color: white;
}

#modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
}

#modal {
  background: white;
  padding: 20px;
  border-radius: 8px;
}

#open-add-player {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #4CAF50; /* Green */
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    transition: background-color 0.3s ease;
  }

  #open-add-player:hover {
    background-color: #45a049;
  }

  </style>
</head>
<body>
  <input id="search-bar" placeholder="Search players..." />
  <div id="player-list"></div>
  <button id="open-add-player">ï¼‹</button>

  <!-- Add Player Modal -->
  <div id="modal-overlay">
    <div id="modal">
      <input id="player-name-input" placeholder="Enter player name" />
      <button id="done-button">Add</button>
      <button id="cancel-button">Cancel</button>
    </div>
  </div>

  <!-- Player Profile Panel -->
  <div id="player-profile">
  <img id="profile-skin" alt="Player Skin" />
  <h2 id="profile-name">Player Name</h2>
  <div id="profile-tiers"></div>
  <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 10px; font-size:20px;">
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/vanilla.svg" class="kit-icon" onclick="openKitSettings('Crystal')" />
      <div id="tier-Crystal"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/axe.svg" class="kit-icon" onclick="openKitSettings('Axe')" />
      <div id="tier-Axe"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/sword.svg" class="kit-icon" onclick="openKitSettings('Sword')" />
      <div id="tier-Sword"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/uhc.svg" class="kit-icon" onclick="openKitSettings('Uhc')" />
      <div id="tier-Uhc"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/smp.svg" class="kit-icon" onclick="openKitSettings('Smp')" />
      <div id="tier-Smp"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/nethop.svg" class="kit-icon" onclick="openKitSettings('Nethop')" />
      <div id="tier-Nethop"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/pot.svg" class="kit-icon" onclick="openKitSettings('DiamondPot')" />
      <div id="tier-DiamondPot"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://subtiers.net/assets/dia_smp-523efa38.svg" class="kit-icon" onclick="openKitSettings('DiamondSmp')" />
      <div id="tier-DiamondSmp"></div>
    </div>
    <div style="text-align: center;">
      <img src="https://mctiers.com/tier_icons/mace.svg" class="kit-icon" onclick="openKitSettings('Mace')" />
      <div id="tier-Mace"></div>
    </div>
  </div>
</div>

  <div id="kit-panel" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #222;
  padding: 20px;
  border-radius: 10px;
  z-index: 999;
  color: white;
  text-align: center;
">
  <h3 id="kit-title">Select Tier</h3>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 10px 0;">
    <button onclick="selectTier('LT5')">LT5</button>
<button onclick="selectTier('HT5')">HT5</button>
<button onclick="selectTier('LT4')">LT4</button>
<button onclick="selectTier('HT4')">HT4</button>
<button onclick="selectTier('LT3')">LT3</button>
<button onclick="selectTier('HT3')">HT3</button>
<button onclick="selectTier('LT2')">LT2</button>
<button onclick="selectTier('HT2')">HT2</button>
<button onclick="selectTier('LT1')">LT1</button>
<button onclick="selectTier('HT1')">HT1</button>
  </div>
  <button onclick="closeKitSettings()">Cancel</button>
</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDziQ1jdojoUwYDUpGLNfbzMDh5-iB1QIQ",
      authDomain: "yugotiers-b297d.firebaseapp.com",
      projectId: "yugotiers-b297d",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let selectedPlayerId = null;
    const profile = document.getElementById('player-profile');
    const profileName = document.getElementById('profile-name');
    const profileTiers = document.getElementById('profile-tiers');

    async function fetchPlayers() {
      const snapshot = await db.collection('players').get();
      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    function openProfile(player) {
      selectedPlayerId = player.id;
      profile.style.display = 'flex';
      profileName.textContent = player.name;
      // Clear previous tier labels
      const kitIcons = profile.querySelectorAll('.kit-icon');
      kitIcons.forEach(icon => {
        // Remove any existing tier-label next to icon first
        const next = icon.nextSibling;
        if (next && next.className === 'tier-label') {
          next.remove();
        }
      });
      // Add tier labels next to each kit icon
      kitIcons.forEach(icon => {
        const kitName = icon.getAttribute('onclick').match(/openKitSettings\('(.+)'\)/)[1];
        let existingTier = player.tiers?.find(t => t.kit === kitName.toUpperCase());
        let label = document.createElement('div');
        label.className = 'tier-label';
        label.textContent = existingTier ? existingTier.tier : 'No Tier';
        icon.insertAdjacentElement('afterend', label);
        icon.onclick = () => showTierOptions(icon, kitName.toUpperCase(), label);
      });
    }

    function showTierOptions(icon, kit, label) {
      // Remove previous popup if any
      const old = document.querySelector('.tier-popup');
      if (old) old.remove();

      const popup = document.createElement('div');
      popup.className = 'tier-popup';
      popup.style.position = 'absolute';
      popup.style.backgroundColor = '#333';
      popup.style.border = '1px solid #555';
      popup.style.borderRadius = '4px';
      popup.style.padding = '5px';
      popup.style.zIndex = '1000';

      const tiers = ['HT1', 'HT2', 'HT3', 'LT1', 'LT2', 'LT3','LT5','HT5','LT4','HT4'];
      tiers.forEach(tier => {
        const btn = document.createElement('button');
        btn.textContent = tier;
        btn.style.margin = '2px';
        btn.style.padding = '4px';
        btn.style.cursor = 'pointer';
        btn.onclick = async () => {
          await applyTierToPlayer(kit, tier);
          label.textContent = tier;
          popup.remove();
        };
        popup.appendChild(btn);
      });

      // Position near icon
      const rect = icon.getBoundingClientRect();
      popup.style.left = rect.left + 'px';
      popup.style.top = rect.bottom + 'px';
      document.body.appendChild(popup);
    }

    const modalOverlay = document.getElementById('modal-overlay');
    const playerNameInput = document.getElementById('player-name-input');
    const doneButton = document.getElementById('done-button');
    const cancelButton = document.getElementById('cancel-button');
    const openAddPlayerBtn = document.getElementById('open-add-player');

    let players = []; // global players array
    let currentEditingTiers = []; // for new player

    // Open modal when Add Player clicked
    openAddPlayerBtn.addEventListener('click', () => {
      playerNameInput.value = "";
      modalOverlay.style.display = "flex";
      playerNameInput.focus();
    });

    // Cancel closes modal without saving
    cancelButton.addEventListener('click', () => {
      modalOverlay.style.display = "none";
    });

    // Add player on done button click
    doneButton.addEventListener('click', async () => {
      const name = playerNameInput.value.trim();
      if (!name) {
        alert("Please enter a player name");
        return;
      }

      // Optional: check if player name exists
      if (players.find(p => p.name.toLowerCase() === name.toLowerCase())) {
        alert("Player with this name already exists.");
        return;
      }

      // Add player to Firestore
      const newPlayer = {
        name,
        tiers: currentEditingTiers.slice() // clone array, can be empty
      };

      try {
        const docRef = await db.collection('players').add(newPlayer);
        newPlayer.id = docRef.id;
        players.push(newPlayer);
        modalOverlay.style.display = "none";
        currentEditingTiers = [];
        renderPlayers(players);
        alert(`Player "${name}" added!`);
      } catch (e) {
        alert("Error adding player: " + e.message);
      }
    });

    async function applyTierToPlayer(kit, tier) {
      if (!selectedPlayerId) return;

      const docRef = db.collection('players').doc(selectedPlayerId);
      const doc = await docRef.get();
      const player = doc.data();

      let tiers = player.tiers || [];

      const existingIndex = tiers.findIndex(t => t.kit === kit);
      if (existingIndex !== -1) {
        tiers[existingIndex].tier = tier;
      } else {
        tiers.push({ kit, tier });
      }

      await docRef.update({ tiers });

      // Also update local copy for UI sync
      let localPlayer = players.find(p => p.id === selectedPlayerId);
      if (localPlayer) {
        localPlayer.tiers = tiers;
      }
    }

    // Load players into list
    const playerList = document.getElementById('player-list');
    const searchBar = document.getElementById('search-bar');

    async function refreshPlayers(filter = '') {
      players = await fetchPlayers();
      if (filter) {
        players = players.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
      }
      renderPlayers(players);
    }

    function renderPlayers(players) {
      playerList.innerHTML = '';
      players.forEach(p => {
  const container = document.createElement('div');
  container.textContent = p.name;
  container.className = 'player-link';
  container.onclick = () => openProfile(p);
  playerList.appendChild(container);
});
    }


    searchBar.oninput = () => refreshPlayers(searchBar.value);
    refreshPlayers();

    // Dummy openKitSettings function to satisfy onclick in HTML
    function openKitSettings(kitName) {
      // This is overridden in openProfile for actual behavior
      console.log('Kit clicked:', kitName);
    }
  </script>
</body>
</html>

